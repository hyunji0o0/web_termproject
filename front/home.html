<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>마이 피트니스 파트너</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="gradient_back.css" />
</head>
<body class="main-page">
<a href="login.html" class="login-link">로그인</a>
<div class="gradient-bg"></div>
    
<div class="title-box">
    <h1>마이 피트니스 파트너</h1>
    <div class="gradient-buttons">
        <button>기초대사량/BMI</button>
        <button>식품 영양성분 계산</button>
        <button>활동대사량 계산</button>
    </div>

    <div class="summary-wrapper">
        
        <!-- 오늘의 섭취량 -->
        <div class="summary-circle">
            <p>오늘의 섭취량</p>
            <span id="today-intake-kcal">0</span> kcal
        </div>

        <div class="summary-circle">
            <p>BMI</p>
            <span id="today-bmi">0</span>
        </div>

        <!-- 오늘의 활동대사량 -->
        <div class="summary-circle">
            <p>오늘의 활동대사량</p>
            <span id="today-activity-kcal">0</span> kcal
        </div>

    </div>


</div>

<!--기초대사량/BMI 계산하는 부분-->
<div id="white-section">
    <h1 class="section-title" id="bmi-section">기초대사량 / BMI 계산</h1>

    <div class="calculator-container">
        <div class="bmr-box card">
            <h2 class="calc-title">기초대사량 계산기</h2>

            <div class="input-group">
                <label>성별</label>
                <select id="gender">
                    <option value="">- 선택 -</option>
                    <option value="male">남성</option>
                    <option value="female">여성</option>
                </select>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>신장 (cm)</label>
                    <input type="number" id="height" placeholder="키 입력">
                </div>

                <div class="input-group">
                    <label>체중 (kg)</label>
                    <input type="number" id="weight" placeholder="몸무게 입력">
                </div>

                <div class="input-group">
                    <label>나이 (만)</label>
                    <input type="number" id="age" placeholder="나이 입력">
                </div>
            </div>

            <button class="calc-btn" onclick="calculateBMR()">계산하기 ✓</button>

            <div class="calc-result">
                <p>기초대사량</p>
                <span id="bmr-value">0</span> kcal
            </div>
        </div>

        <div class="bmi-box card">
            <h2 class="calc-title">BMI 계산기</h2>

            <div class="input-row">
                <div class="input-group">
                    <label>신장 (cm)</label>
                    <input type="number" id="bmi-height" placeholder="키 입력">
                </div>

                <div class="input-group">
                    <label>체중 (kg)</label>
                    <input type="number" id="bmi-weight" placeholder="몸무게 입력">
                </div>
            </div>

            <button class="calc-btn" onclick="calculateBMI()">계산하기 ✓</button>

            <div class="calc-result">
                <p>BMI</p>
                <span id="bmi-value">0</span>
            </div>
            <div class="bmi-status-box">
                <p id="bmi-status-text">체질량지수 결과</p>
            </div>
        </div>
    </div>

    <!--영양성분 계산기 부분-->
    <h1 class="section-title" id="food-section">영양성분 계산기</h1>
    <div class="search-grid">

        <!-- 1. 검색 조건 -->
        <div class="search-box card">
            <div class="input-group">
                <label>분류 선택</label>
                <select id="food-category">
                    <option value="">- 선택 -</option>
                    <option value="raw">원재료성</option>
                    <option value="processed">가공식품</option>
                    <option value="meal">음식</option>
                </select>
            </div>
        <!-- 2. 음식 검색 -->
            <div class="input-group">
                <label>검색어 입력</label>
                <input type="text" id="food-search" placeholder="음식 이름 입력">
            </div>
        <!-- 3. 검색 페이지 -->
        </div>
    </div>
<!-- ▼ 영양성분 계산기 : 검색결과 + 상세 + 접시 -->
<div class="nutrition-layout">

  <!-- 왼쪽: 스크롤 목록 -->
  <section class="card panel food-list" id="food-list">
    <div class="empty">검색 후 결과가 여기에 나타납니다.</div>
    <div id="food-sentinel"></div>
  </section>

  <!-- 오른쪽: 상세 + 접시 -->
  <section class="right-col">
    <!-- 상세 -->
    <aside class="card panel" id="food-detail">
      <div class="empty">항목을 선택하면 상세가 표시됩니다.</div>
    </aside>

    <!-- 접시 테이블 -->
    <section class="card panel">
      <h3 style="margin:4px 0 8px;">🍽 접시</h3>
      <table class="plate-table">
        <thead>
          <tr>
            <th>식품명</th>
            <th>단위량</th>
            <th>열량(kcal)</th>
            <th>탄수화물(g)</th>
            <th>단백질(g)</th>
            <th>지방(g)</th>
            <th>중량(g)</th>
            <th>삭제</th>
          </tr>
        </thead>
        <tbody id="plate-body">
          <tr class="empty-row"><td colspan="8" class="muted">접시에 담긴 식품이 없습니다.</td></tr>
        </tbody>
      </table>

      <button id="btn-plate-calc" class="calc-btn" style="margin-top:8px;">계산하기 ✓</button>
      <div id="calc-total-box" class="total-box muted">계산 결과가 여기에 표시됩니다.</div>
    </section>
  </section>

</div>


    <!--활동 대사량 부분-->
    <h1 class="section-title" id="activity-section">활동대사량 계산기</h1>

    <div class="activity-box card">

    <div class="input-group">
        <label>체중 (kg)</label>
        <input type="number" id="activity-weight" placeholder="몸무게 입력">
    </div>
    <!-- 운동 종목 선택 -->
    <div class="input-group">
        <label>운동 종목</label>
        <select id="activity-select">
            <option value="">- 선택 -</option>
            <option value="3.5">가벼운 걷기 (MET 3.5)</option>
            <option value="7">조깅 (MET 7)</option>
            <option value="8">달리기 (MET 8)</option>
            <option value="4">자전거 (MET 4)</option>
            <option value="6">수영 (MET 6)</option>
            <option value="5">근력운동 (MET 5)</option>
        </select>
    </div>

    <!-- 운동 시간 입력 -->
    <div class="input-group">
        <label>운동 시간</label>
        <div style="display:flex; gap:10px;">
            <select id="activity-hour">
                <option value="0">0 시간</option>
            </select>

            <input type="number" id="activity-minute" placeholder="분 (m)" min="0" max="59">
        </div>
    </div>

    <button class="calc-btn" onclick="calculateActivity()">계산하기 ✓</button>

    <div class="calc-result">
        <p>활동대사량</p>
        <span id="activity-value">0</span> kcal
    </div>
</div>
</div>
<script>
// 1. 홈 화면 로드 시 로그인 상태 확인
document.addEventListener("DOMContentLoaded", () => {

    const token = localStorage.getItem("token");



    // 로그인 되어 있으면 로그인 링크 → 로그아웃 링크로 변경
    const loginLink = document.querySelector(".login-link");
    if (token && loginLink) {
        loginLink.textContent = "로그아웃";
        loginLink.href = "#";
        loginLink.onclick = logout;
    }

    // 2. 토큰을 보내서 사용자 정보 요청
    fetch("../back/request_user_info.php", {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + token,
            "Content-Type": "application/json"
        }
    })
    .then(res => res.json())
    .then(data => {
        if (!data.success) {
            console.log("토큰 만료 → 비로그인 모드로 전환");
            localStorage.removeItem("token"); // 강제 로그아웃
            return;   // 에러 알림 금지
        }
    })
    .catch(err => {
        console.error("요청 오류:", err);
    });
});


// 4. 로그아웃 기능
function logout() {
    localStorage.removeItem("token");
    window.location.href = "home.html";
}
</script>


<script src="script.js"></script>
</body>
</html>
